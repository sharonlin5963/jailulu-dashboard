import{a as n,o as a,w as F,y as G}from"./chunk-NL6KNZEE-CQkoafV0.js";import{B as V}from"./BaseTable-YSHpC9rB.js";import{L as W}from"./Loading-2XmdfwSh.js";import{B as _,T as X,F as T,a as I,S as M,E as J}from"./Alert-4o-22xWm.js";import{H as K}from"./Header-BLSKRTB6.js";import{b as Y,g as Z,u as Q,j as O,c as $,d as tt,e as et,m as C,f as at,q as st,B as q,y as H,z as U,A as E,D as ot,E as rt}from"./config-DlFqBImT.js";import{S as it,M as b}from"./MenuItem-Duz-n7oc.js";import{e as y,f as A,l as lt,g as nt}from"./createTheme-CCn_blMs.js";import"./index-DBUmQ_pX.js";import"./index-LvXiyyRQ.js";function ct(t){return Z("MuiSwitch",t)}const i=Y("MuiSwitch",["root","edgeStart","edgeEnd","switchBase","colorPrimary","colorSecondary","sizeSmall","sizeMedium","checked","disabled","input","thumb","track"]),dt=t=>{const{classes:e,edge:o,size:u,color:v,checked:h,disabled:g}=t,m={root:["root",o&&`edge${y(o)}`,`size${y(u)}`],switchBase:["switchBase",`color${y(v)}`,h&&"checked",g&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},S=et(m,ct,e);return{...e,...S}},pt=$("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:o}=t;return[e.root,o.edge&&e[`edge${y(o.edge)}`],e[`size${y(o.size)}`]]}})({display:"inline-flex",width:34+12*2,height:14+12*2,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"},variants:[{props:{edge:"start"},style:{marginLeft:-8}},{props:{edge:"end"},style:{marginRight:-8}},{props:{size:"small"},style:{width:40,height:24,padding:7,[`& .${i.thumb}`]:{width:16,height:16},[`& .${i.switchBase}`]:{padding:4,[`&.${i.checked}`]:{transform:"translateX(16px)"}}}}]}),ut=$(it,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(t,e)=>{const{ownerState:o}=t;return[e.switchBase,{[`& .${i.input}`]:e.input},o.color!=="default"&&e[`color${y(o.color)}`]]}})(C(({theme:t})=>({position:"absolute",top:0,left:0,zIndex:1,color:t.vars?t.vars.palette.Switch.defaultColor:`${t.palette.mode==="light"?t.palette.common.white:t.palette.grey[300]}`,transition:t.transitions.create(["left","transform"],{duration:t.transitions.duration.shortest}),[`&.${i.checked}`]:{transform:"translateX(20px)"},[`&.${i.disabled}`]:{color:t.vars?t.vars.palette.Switch.defaultDisabledColor:`${t.palette.mode==="light"?t.palette.grey[100]:t.palette.grey[600]}`},[`&.${i.checked} + .${i.track}`]:{opacity:.5},[`&.${i.disabled} + .${i.track}`]:{opacity:t.vars?t.vars.opacity.switchTrackDisabled:`${t.palette.mode==="light"?.12:.2}`},[`& .${i.input}`]:{left:"-100%",width:"300%"}})),C(({theme:t})=>({"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:A(t.palette.action.active,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},variants:[...Object.entries(t.palette).filter(at(["light"])).map(([e])=>({props:{color:e},style:{[`&.${i.checked}`]:{color:(t.vars||t).palette[e].main,"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette[e].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:A(t.palette[e].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${i.disabled}`]:{color:t.vars?t.vars.palette.Switch[`${e}DisabledColor`]:`${t.palette.mode==="light"?lt(t.palette[e].main,.62):nt(t.palette[e].main,.55)}`}},[`&.${i.checked} + .${i.track}`]:{backgroundColor:(t.vars||t).palette[e].main}}}))]}))),ht=$("span",{name:"MuiSwitch",slot:"Track"})(C(({theme:t})=>({height:"100%",width:"100%",borderRadius:14/2,zIndex:-1,transition:t.transitions.create(["opacity","background-color"],{duration:t.transitions.duration.shortest}),backgroundColor:t.vars?t.vars.palette.common.onBackground:`${t.palette.mode==="light"?t.palette.common.black:t.palette.common.white}`,opacity:t.vars?t.vars.opacity.switchTrack:`${t.palette.mode==="light"?.38:.3}`}))),gt=$("span",{name:"MuiSwitch",slot:"Thumb"})(C(({theme:t})=>({boxShadow:(t.vars||t).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"}))),mt=n.forwardRef(function(e,o){const u=Q({props:e,name:"MuiSwitch"}),{className:v,color:h="primary",edge:g=!1,size:m="medium",sx:S,slots:s={},slotProps:l={},...f}=u,d={...u,color:h,edge:g,size:m},w=dt(d),x={slots:s,slotProps:l},[B,z]=O("root",{className:tt(w.root,v),elementType:pt,externalForwardedProps:x,ownerState:d,additionalProps:{sx:S}}),[P,c]=O("thumb",{className:w.thumb,elementType:gt,externalForwardedProps:x,ownerState:d}),r=a.jsx(P,{...c}),[p,k]=O("track",{className:w.track,elementType:ht,externalForwardedProps:x,ownerState:d});return a.jsxs(B,{...z,children:[a.jsx(ut,{type:"checkbox",icon:r,checkedIcon:r,ref:o,ownerState:d,...f,classes:{...w,root:w.switchBase},slots:{...s.switchBase&&{root:s.switchBase},...s.input&&{input:s.input}},slotProps:{...l.switchBase&&{root:typeof l.switchBase=="function"?l.switchBase(d):l.switchBase},...l.input&&{input:typeof l.input=="function"?l.input(d):l.input}}}),a.jsx(p,{...k})]})}),bt=st(a.jsx("path",{d:"M3 10h11v2H3zm0-2h11V6H3zm0 8h7v-2H3zm15.01-3.13.71-.71c.39-.39 1.02-.39 1.41 0l.71.71c.39.39.39 1.02 0 1.41l-.71.71zm-.71.71-5.3 5.3V21h2.12l5.3-5.3z"})),vt=({searchQuery:t,setSearchQuery:e,onSearch:o})=>{const[u,v]=n.useState([]),[h,g]=n.useState(!1),m=()=>{e({name:"",group:"",status:"",isSale:""}),o()},S=async()=>{g(!0);try{const l=(await H(U(E,"groups"))).docs.map(f=>f.data());v(l)}finally{g(!1)}};return n.useEffect(()=>{S()},[]),a.jsxs(_,{className:"flex flex-wrap gap-4 items-center",children:[a.jsx(X,{label:"商品名稱",variant:"outlined",value:t.name,onChange:s=>e({...t,name:s.target.value})}),a.jsxs(T,{sx:{minWidth:160},children:[a.jsx(I,{id:"group-select-label",children:"商品分類"}),a.jsxs(M,{labelId:"group-select-label",value:t.group,label:"商品分類",onChange:s=>e({...t,group:s.target.value}),children:[a.jsx(b,{value:"",children:"全部"}),u.map(s=>a.jsx(b,{value:s.value,children:s.label},s.value))]})]}),a.jsxs(T,{sx:{minWidth:120},children:[a.jsx(I,{id:"status-select-label",children:"上下架"}),a.jsxs(M,{labelId:"status-select-label",value:t.status,label:"上下架",onChange:s=>e({...t,status:s.target.value}),children:[a.jsx(b,{value:"",children:"全部"}),a.jsx(b,{value:"1",children:"上架"}),a.jsx(b,{value:"0",children:"下架"})]})]}),a.jsxs(T,{sx:{minWidth:120},children:[a.jsx(I,{id:"sale-select-label",children:"商品價格"}),a.jsxs(M,{labelId:"sale-select-label",value:t.isSale,label:"商品價格",onChange:s=>e({...t,isSale:s.target.value}),children:[a.jsx(b,{value:"",children:"全部"}),a.jsx(b,{value:"true",children:"特價"}),a.jsx(b,{value:"false",children:"原價"})]})]}),a.jsx(q,{disabled:h,variant:"contained",onClick:o,children:"搜尋"}),a.jsx(q,{disabled:h,variant:"outlined",onClick:m,children:"清空"})]})},St=({imageUrl:t,name:e})=>a.jsx("img",{src:t,alt:e,className:"rounded size-20 aspect-square m-auto",referrerPolicy:"no-referrer"}),wt=({id:t,status:e})=>a.jsx(G,{to:e===1?"#":`/products/${t}`,onClick:o=>{e===1&&o.preventDefault()},children:a.jsx(bt,{sx:{fontSize:32,color:e===1?"#ccc":"#7f7e83",cursor:e===1?"not-allowed":"pointer"}})}),ft=()=>{const[t,e]=n.useState([]),[o,u]=n.useState([]),[v,h]=n.useState(!1),[g,m]=n.useState({message:""}),[S,s]=n.useState(!1),[l,f]=n.useState(!1),[d,w]=n.useState({name:"",group:"",status:"",isSale:""}),x=async()=>{try{h(!0);const r=(await H(U(E,"products"))).docs.map(p=>({id:p.id,...p.data()}));u(r),e(r)}finally{h(!1)}},B=({id:c,status:r})=>{const p=async()=>{const k=r===1?0:1,j=r===1?"下架":"上架";f(!0);try{await ot(rt(E,"products",c),{status:k}),m({message:`商品${j}成功`,type:"success"}),s(!0),x()}catch{m({message:`商品${j}失敗`,type:"error"}),s(!0)}finally{f(!1)}};return a.jsx(mt,{checked:r===1,onChange:p,disabled:l,color:"primary"})},z=[{id:"imageUrl",label:"商品圖片",align:"center",format:(c,r)=>St(r)},{id:"name",label:"商品名稱"},{id:"group",label:"商品分類",format:c=>c.label},{id:"price",label:"價格",align:"right"},{id:"specialPrice",label:"特價價格",align:"right"},{id:"status",label:"上架",align:"center",format:(c,r)=>B(r)},{id:"edit",label:"編輯",align:"center",format:(c,r)=>wt(r)}],P=()=>{const c=t.filter(({name:r,group:p,status:k,isSale:j})=>{const{name:N,group:R,status:D,isSale:L}=d;return r.toLowerCase().includes(N.toLowerCase())&&(R===""||(p==null?void 0:p.value)===R)&&(D===""||k===Number(D))&&(L===""||j===(L==="true"))});u(c)};return n.useEffect(()=>{x()},[]),a.jsxs("main",{className:"wrapper dashboard",children:[a.jsx(K,{title:"商品管理",description:"查看商品列表並管理商品資訊，包括新增、編輯、商品上下架功能。",ctaText:"新增商品",ctaUrl:"/products/create"}),a.jsx(vt,{searchQuery:d,setSearchQuery:w,onSearch:P}),a.jsx(V,{columns:z,rows:o,stickyHeader:!0}),a.jsx(W,{open:v}),a.jsx(J,{open:S,message:g.message,severity:g.type,anchorOrigin:{vertical:"top",horizontal:"right"},onClose:()=>s(!1)})]})},It=F(ft);export{It as default};
