import{o as t,a as b,w as _,v as ee,z as re}from"./chunk-NL6KNZEE-CQkoafV0.js";import{m as te,u as oe,f as ae,B as se,T as F,E as le}from"./Alert-4o-22xWm.js";import{H as ne}from"./Header-BLSKRTB6.js";import{T as A,U as ie,u as ce}from"./index-DhLl5fkL.js";import{q as O,b as K,g as Q,u as X,j as Y,d as B,c as H,e as Z,p as pe,m as V,f as D,P as de,B as ue,H as me,D as be,E as fe,A as W,I as he,z as xe}from"./config-DlFqBImT.js";import{c as ge,b as G,d as ve,a as U,e as Ce,u as ye,o as Se}from"./index.esm-Du1fJ1Qh.js";import{S as Pe,M as je}from"./MenuItem-Duz-n7oc.js";import{e as w,f as J}from"./createTheme-CCn_blMs.js";import"./index-DBUmQ_pX.js";import"./index-LvXiyyRQ.js";const ke=O(t.jsx("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"})),$e=O(t.jsx("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})),we=O(t.jsx("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z"}));function Ie(e){return Q("MuiCheckbox",e)}const N=K("MuiCheckbox",["root","checked","disabled","indeterminate","colorPrimary","colorSecondary","sizeSmall","sizeMedium"]),Re=e=>{const{classes:r,indeterminate:a,color:o,size:c}=e,n={root:["root",a&&"indeterminate",`color${w(o)}`,`size${w(c)}`]},u=Z(n,Ie,r);return{...r,...u}},ze=H(Pe,{shouldForwardProp:e=>pe(e)||e==="classes",name:"MuiCheckbox",slot:"Root",overridesResolver:(e,r)=>{const{ownerState:a}=e;return[r.root,a.indeterminate&&r.indeterminate,r[`size${w(a.size)}`],a.color!=="default"&&r[`color${w(a.color)}`]]}})(V(({theme:e})=>({color:(e.vars||e).palette.text.secondary,variants:[{props:{color:"default",disableRipple:!1},style:{"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette.action.activeChannel} / ${e.vars.palette.action.hoverOpacity})`:J(e.palette.action.active,e.palette.action.hoverOpacity)}}},...Object.entries(e.palette).filter(D()).map(([r])=>({props:{color:r,disableRipple:!1},style:{"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette[r].mainChannel} / ${e.vars.palette.action.hoverOpacity})`:J(e.palette[r].main,e.palette.action.hoverOpacity)}}})),...Object.entries(e.palette).filter(D()).map(([r])=>({props:{color:r},style:{[`&.${N.checked}, &.${N.indeterminate}`]:{color:(e.vars||e).palette[r].main},[`&.${N.disabled}`]:{color:(e.vars||e).palette.action.disabled}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:"transparent"}}}}]}))),Te=t.jsx($e,{}),Fe=t.jsx(ke,{}),Me=t.jsx(we,{}),qe=b.forwardRef(function(r,a){const o=X({props:r,name:"MuiCheckbox"}),{checkedIcon:c=Te,color:n="primary",icon:u=Fe,indeterminate:l=!1,indeterminateIcon:f=Me,inputProps:I,size:m="medium",disableRipple:y=!1,className:S,slots:p={},slotProps:R={},...z}=o,s=l?f:u,P=l?f:c,j={...o,disableRipple:y,color:n,indeterminate:l,size:m},x=Re(j),i=R.input??I,[g,h]=Y("root",{ref:a,elementType:ze,className:B(x.root,S),shouldForwardComponentProp:!0,externalForwardedProps:{slots:p,slotProps:R,...z},ownerState:j,additionalProps:{type:"checkbox",icon:b.cloneElement(s,{fontSize:s.props.fontSize??m}),checkedIcon:b.cloneElement(P,{fontSize:P.props.fontSize??m}),disableRipple:y,slots:p,slotProps:{input:te(typeof i=="function"?i(j):i,{"data-indeterminate":l})}}});return t.jsx(g,{...h,classes:x})});function Le(e){return Q("MuiFormControlLabel",e)}const M=K("MuiFormControlLabel",["root","labelPlacementStart","labelPlacementTop","labelPlacementBottom","disabled","label","error","required","asterisk"]),Ee=e=>{const{classes:r,disabled:a,labelPlacement:o,error:c,required:n}=e,u={root:["root",a&&"disabled",`labelPlacement${w(o)}`,c&&"error",n&&"required"],label:["label",a&&"disabled"],asterisk:["asterisk",c&&"error"]};return Z(u,Le,r)},Ue=H("label",{name:"MuiFormControlLabel",slot:"Root",overridesResolver:(e,r)=>{const{ownerState:a}=e;return[{[`& .${M.label}`]:r.label},r.root,r[`labelPlacement${w(a.labelPlacement)}`]]}})(V(({theme:e})=>({display:"inline-flex",alignItems:"center",cursor:"pointer",verticalAlign:"middle",WebkitTapHighlightColor:"transparent",marginLeft:-11,marginRight:16,[`&.${M.disabled}`]:{cursor:"default"},[`& .${M.label}`]:{[`&.${M.disabled}`]:{color:(e.vars||e).palette.text.disabled}},variants:[{props:{labelPlacement:"start"},style:{flexDirection:"row-reverse",marginRight:-11}},{props:{labelPlacement:"top"},style:{flexDirection:"column-reverse"}},{props:{labelPlacement:"bottom"},style:{flexDirection:"column"}},{props:({labelPlacement:r})=>r==="start"||r==="top"||r==="bottom",style:{marginLeft:16}}]}))),Ne=H("span",{name:"MuiFormControlLabel",slot:"Asterisk"})(V(({theme:e})=>({[`&.${M.error}`]:{color:(e.vars||e).palette.error.main}}))),Be=b.forwardRef(function(r,a){const o=X({props:r,name:"MuiFormControlLabel"}),{checked:c,className:n,componentsProps:u={},control:l,disabled:f,disableTypography:I,inputRef:m,label:y,labelPlacement:S="end",name:p,onChange:R,required:z,slots:s={},slotProps:P={},value:j,...x}=o,i=oe(),g=f??l.props.disabled??(i==null?void 0:i.disabled),h=z??l.props.required,T={disabled:g,required:h};["checked","name","onChange","value","inputRef"].forEach(L=>{typeof l.props[L]>"u"&&typeof o[L]<"u"&&(T[L]=o[L])});const d=ae({props:o,muiFormControl:i,states:["error"]}),v={...o,disabled:g,labelPlacement:S,required:h,error:d.error},C=Ee(v),E={slots:s,slotProps:{...u,...P}},[q,k]=Y("typography",{elementType:A,externalForwardedProps:E,ownerState:v});let $=y;return $!=null&&$.type!==A&&!I&&($=t.jsx(q,{component:"span",...k,className:B(C.label,k==null?void 0:k.className),children:$})),t.jsxs(Ue,{className:B(C.root,n),ownerState:v,ref:a,...x,children:[b.cloneElement(l,T),h?t.jsxs("div",{children:[$,t.jsxs(Ne,{ownerState:v,"aria-hidden":!0,className:C.asterisk,children:[" ","*"]})]}):$]})}),Oe=ge().shape({name:U().required("請輸入商品名稱"),describe:U().required("請輸入商品描述"),group:U().required("請選擇商品分類"),price:G().typeError("價格必須是數字").required("請輸入價格").positive("價格必須大於 0"),isSale:ve().required(),specialPrice:G().default(0).typeError("特價價格必須是數字").when("isSale",{is:!0,then:e=>e.required("請輸入特價價格").moreThan(0,"特價價格必須大於 0").max(Ce("price"),"特價不能高於原價"),otherwise:e=>e.notRequired()})}),He=({loaderData:e})=>{var x,i,g,h,T;const r=ee(),{id:a}=re(),{initialProduct:o,groups:c}=e,[n,u]=b.useState(null),[l,f]=b.useState({message:""}),[I,m]=b.useState(!1),[y,S]=b.useState(!1),{register:p,handleSubmit:R,watch:z,formState:{errors:s}}=ye({resolver:Se(Oe),defaultValues:{price:1,specialPrice:0,...o}}),P=z("isSale"),j=async d=>{if(!n&&!(o!=null&&o.imageUrl)){f({message:"請先選擇圖片",type:"error"}),m(!0);return}const v=a?"編輯":"新增";S(!0);try{let C=(o==null?void 0:o.imageUrl)??"";n&&(C=await ce(n));const E=c.find(k=>k.value===d.group),q={...d,group:E,imageUrl:C,createdAt:me.now(),status:0};a?await be(fe(W,"products",a),q):await he(xe(W,"products"),q),f({message:`商品${v}成功！`,type:"success"}),m(!0),r("/products")}catch{f({message:`${v}失敗，請稍後再試`,type:"error"}),m(!0)}finally{S(!1)}};return t.jsxs("main",{className:"wrapper dashboard",children:[t.jsx(ne,{title:`${a?"編輯":"新增"}商品`}),t.jsx("section",{className:"mt-2.5 wrapper-md",children:t.jsx(de,{elevation:3,sx:{borderRadius:"20px"},children:t.jsxs(se,{component:"form",noValidate:!0,className:"flex flex-col gap-6 w-full p-10",children:[t.jsx(ie,{defaultImage:o==null?void 0:o.imageUrl,onImageSelect:d=>u(d)}),t.jsx(F,{label:"商品名稱",variant:"outlined",fullWidth:!0,...p("name"),error:!!s.name,helperText:(x=s.name)==null?void 0:x.message}),t.jsx(F,{label:"商品描述",variant:"outlined",fullWidth:!0,multiline:!0,minRows:4,...p("describe"),error:!!s.describe,helperText:(i=s.describe)==null?void 0:i.message,defaultValue:""}),t.jsx(F,{select:!0,label:"商品分類",variant:"outlined",fullWidth:!0,...p("group"),error:!!s.group,helperText:(g=s.group)==null?void 0:g.message,defaultValue:o==null?void 0:o.group,children:c.map(d=>t.jsx(je,{value:d.value,children:d.label},d.value))}),t.jsx(F,{label:"價格",variant:"outlined",fullWidth:!0,...p("price"),error:!!s.price,helperText:(h=s.price)==null?void 0:h.message}),t.jsx(Be,{control:t.jsx(qe,{...p("isSale")}),label:"特價商品"}),P&&t.jsx(F,{label:"特價價格",variant:"outlined",fullWidth:!0,...p("specialPrice"),error:!!s.specialPrice,helperText:(T=s.specialPrice)==null?void 0:T.message}),t.jsx(ue,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,loading:y,loadingPosition:"start",onClick:R(j),children:a?"更新商品":"新增商品"})]})})}),t.jsx(le,{open:I,message:l.message,severity:l.type,anchorOrigin:{vertical:"top",horizontal:"right"},onClose:()=>m(!1)})]})},Ze=_(He);export{Ze as default};
